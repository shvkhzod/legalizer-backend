# Railway Deployment Guide - Backend

Step-by-step guide to deploy the Legal Compliance Checker backend on Railway.

## Prerequisites

- GitHub account
- Railway account (Hobby plan recommended)
- Backend repository pushed to GitHub

## Step 1: Push Backend to GitHub

1. Initialize git repository:
```bash
cd legalizer-backend
git init
git add .
git commit -m "Initial backend setup"
```

2. Create a new repository on GitHub named `legalizer-backend`

3. Push to GitHub:
```bash
git remote add origin https://github.com/yourusername/legalizer-backend.git
git branch -M main
git push -u origin main
```

## Step 2: Create Railway Project

1. Go to [Railway Dashboard](https://railway.app/dashboard)
2. Click **New Project**
3. Select **Empty Project**
4. Name it: "Legal Compliance Checker"

## Step 3: Add PostgreSQL Database

1. In your Railway project, click **+ New**
2. Select **Database** → **PostgreSQL**
3. Railway will automatically create and configure the database

## Step 4: Deploy Backend Service

1. Click **+ New** → **GitHub Repo**
2. Select your `legalizer-backend` repository
3. Railway will automatically detect it as a Node.js project

## Step 5: Configure Environment Variables

1. Click on the Backend service
2. Go to **Variables** tab
3. Add the following variables:

```env
JWT_ACCESS_SECRET=<paste-your-generated-secret>
NODE_ENV=production
CORS_ORIGIN=https://your-frontend-url.railway.app
```

**Generate JWT Secret:**
```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

4. The `DATABASE_URL` variable is automatically added by Railway when you connect to PostgreSQL

## Step 6: Connect Database to Backend

1. Click on your Backend service
2. Go to **Settings** → **Connect**
3. Select your PostgreSQL database
4. Railway will automatically add the `DATABASE_URL` environment variable

## Step 7: Run Database Migration

After the first deployment:

1. Click on **Backend Service**
2. Go to **Settings** → **Deploy**
3. Under **Custom Start Command**, enter:
```bash
npm run migrate && npm start
```
4. Click **Deploy** (or it will auto-deploy)
5. Go to **Deployments** tab and monitor logs
6. After successful migration, go back to **Settings** → **Deploy**
7. Change **Custom Start Command** back to:
```bash
npm start
```
8. **Redeploy**

## Step 8: Get Backend URL

1. Click on Backend service
2. Go to **Settings** → **Networking**
3. Click **Generate Domain** if not already done
4. Copy the public URL (e.g., `https://legalizer-backend-production.up.railway.app`)
5. Save this URL - you'll need it for the frontend

## Step 9: Test Backend

Visit your backend URL with `/health` endpoint:
```
https://your-backend-url.railway.app/health
```

You should see: `{"status":"ok"}`

## Step 10: Update CORS (After Frontend Deployment)

Once you deploy the frontend:

1. Go to **Backend Service** → **Variables**
2. Update `CORS_ORIGIN` with your frontend URL:
```env
CORS_ORIGIN=https://your-frontend-url.railway.app
```
3. Backend will automatically redeploy

## Environment Variables Reference

### Required
- `DATABASE_URL` - Auto-generated by Railway
- `JWT_ACCESS_SECRET` - Random secret for JWT signing
- `NODE_ENV` - Set to `production`
- `CORS_ORIGIN` - Your frontend URL

### Optional
- `PORT` - Railway sets this automatically
- `HOST` - Railway handles this

## Troubleshooting

### Migration Failed?

Check logs in **Deployments** → Click deployment → **View Logs**

Common issues:
- `DATABASE_URL` not set (connect database to service)
- Schema file not found (verify file structure)
- Connection timeout (check database is running)

### Backend Won't Start?

1. Check logs for errors
2. Verify `DATABASE_URL` exists in Variables
3. Ensure migration ran successfully
4. Check `package.json` has correct scripts

### CORS Errors?

1. Verify `CORS_ORIGIN` is set correctly
2. Make sure it matches your frontend URL exactly (no trailing slash)
3. Redeploy backend after changing CORS

## Next Steps

Deploy the frontend! See the frontend repository's RAILWAY_DEPLOYMENT.md for instructions.

## Monitoring

- **Logs**: Deployments → Click deployment → View Logs
- **Metrics**: Click service → Metrics tab
- **Database**: Click PostgreSQL → Data tab to view tables

## Cost

With PostgreSQL + Backend service:
- Free tier: $5/month credit
- After credit: ~$6-8/month

Good luck!
